<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Twist Workshop</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-slate-50 font-sans flex justify-center p-4 md:p-8 min-h-screen">

<div class="w-full max-w-4xl bg-white rounded-3xl shadow-2xl p-8 md:p-16 text-center">
  <h1 class="text-4xl font-black mb-4">The <span class="text-indigo-600 italic">Twist</span> Workshop</h1>
  <div id="scenario-text" class="text-xl font-medium mb-6"></div>
  <textarea id="answer" placeholder="Type your answer here..." class="w-full h-40 p-6 rounded-2xl border border-slate-300 focus:ring-2 focus:ring-indigo-400 mb-4 resize-none"></textarea>
  <button id="submitBtn" class="bg-indigo-600 text-white px-6 py-3 rounded-2xl font-bold hover:bg-indigo-700 transition">Submit</button>

  <div id="result" class="mt-6 text-center"></div>
  <button id="nextBtn" class="bg-slate-900 text-white px-6 py-3 rounded-2xl font-bold mt-4 hover:bg-slate-800 transition hidden">Next Scenario</button>
  <button id="restartBtn" class="bg-amber-500 text-white px-6 py-3 rounded-2xl font-bold mt-4 hover:bg-amber-600 transition hidden">Restart Game</button>

  <div id="progress" class="mt-6 font-bold text-slate-500"></div>
  <footer class="mt-8 text-sm text-slate-400">Created by Knowledge Team</footer>
</div>

<script>
const scenarios = [
  "A colleague interrupts your idea in a meeting.",
  "A colleague asks for a last-minute change.",
  "A teammate messages you blaming you for delay.",
  "A colleague presents your idea as theirs.",
  "A colleague asks a question youâ€™ve already answered multiple times."
];

let currentStep = 0;

const scenarioText = document.getElementById("scenario-text");
const resultDiv = document.getElementById("result");
const answerInput = document.getElementById("answer");
const submitBtn = document.getElementById("submitBtn");
const nextBtn = document.getElementById("nextBtn");
const restartBtn = document.getElementById("restartBtn");
const progressDiv = document.getElementById("progress");

function updateScenario() {
  scenarioText.innerText = scenarios[currentStep];
  progressDiv.innerText = `Scenario ${currentStep+1} of ${scenarios.length}`;
  answerInput.value = "";
  resultDiv.innerHTML = "";
  nextBtn.classList.add("hidden");
}

updateScenario();

submitBtn.addEventListener("click", async () => {
  const answer = answerInput.value.trim();
  if(!answer) return alert("Type your answer");
  resultDiv.innerText = "Scoring...";
  
  try {
    const res = await fetch("https://twist-workshop.vercel.app/api/evaluate", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ scenario: scenarios[currentStep], answer })
    });
    let data = await res.json();
    if(typeof data === "string") data = JSON.parse(data);
    resultDiv.innerHTML = `<div class="p-4 rounded-xl text-white font-bold ${data.score===20?'bg-red-500':data.score===40?'bg-yellow-500':data.score===60?'bg-blue-500':data.score===80?'bg-green-500':'bg-pink-500'}">
      Score: ${data.score}<br>Tip: ${data.tip}
    </div>`;
    nextBtn.classList.remove("hidden");
  } catch(e) {
    console.error(e);
    resultDiv.innerText = "Error scoring answer";
  }
});

nextBtn.addEventListener("click", () => {
  if(currentStep < scenarios.length-1) {
    currentStep++;
    updateScenario();
  } else {
    scenarioText.innerHTML = "<h2>Workshop Complete!</h2>";
    answerInput.style.display = "none";
    submitBtn.style.display = "none";
    nextBtn.style.display = "none";
    restartBtn.classList.remove("hidden");
    resultDiv.innerHTML += "<p class='mt-4 font-bold'>End of all scenarios.</p>";
  }
});

restartBtn.addEventListener("click", () => {
  currentStep = 0;
  answerInput.style.display = "block";
  submitBtn.style.display = "inline-block";
  restartBtn.classList.add("hidden");
  updateScenario();
});
</script>
</body>
</html>
